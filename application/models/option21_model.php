<?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Option21_model extends CI_Model
{
	protected $table='option21';

	public function insertion_option21($jeu,$id_machines,$date_planif,$identifiant)
	{// insertion des donnÃ©es dans la bdd
		
		return $this->db->set('jeu', $jeu)
			->set('id_machines',$id_machines)
			->set('date_planification',$date_planif)
			->set('identifiant',$identifiant)
			->set('statut','p')
			->insert($this->table);
	}
	public function listing_option21_planifier()
	{
		$resultat =$this->db->select('*')
							->from($this->table)
							->join('machines','option21.id_machines=machines.id_machines')
							->join('users','option21.identifiant=users.identifiant')
							->where('statut','p')
							->get()
							->result();
		return $resultat;
	}
	public function listing_option21_en_cours()
	{
		$resultat =$this->db->select('*')
							->from($this->table)
							->join('machines','option21.id_machines=machines.id_machines')
							->join('users','option21.identifiant=users.identifiant')
							->where('statut','c')
							->get()
							->result();
		return $resultat;
	}
	public function listing_option21_historique()
	{
		$resultat =$this->db->select('*')
							->from($this->table)
							->join('machines','option21.id_machines=machines.id_machines')
							->join('users','option21.identifiant=users.identifiant')
							->where('statut','t')
							->or_where('statut','e')
							->order_by('option21.id_opt21','DESC')
							->get()
							->result();
		return $resultat;
	}
	public function suppression_option21($id)
	{
		return $this->db ->where('id_opt21',$id)
						-> delete($this->table);
	}
	public function start_option21($id)
	{	
		$today = date("Y-m-d H:i:s");
		$resultat= $this->db->set('statut', 'c')
					->set('date_debut',$today)
					->where('id_opt21',$id)
					->update($this->table);
	}
	public function fin_ok_option21($id,$commentaire)
	{	
		$today = date("Y-m-d H:i:s");
		$resultat= $this->db->set('statut', 't')
					->set('date_fin',$today)
					->set('commentaire',$commentaire)
					->where('id_opt21',$id)
					->update($this->table);
	}
	public function fin_erreur_option21($id,$commentaire)
	{	
		$today = date("Y-m-d H:i:s");
		$resultat= $this->db->set('statut', 'e')
					->set('date_fin',$today)
					->set('commentaire',$commentaire)
					->where('id_opt21',$id)
					->update($this->table);
	}
	public function planif_a_faire()
	{// requete qui va selectionner les machines qui ont fait leurs denriÃ¨re option12 , il y'a plus de 6 mois
		$resultat =$this->db->select('*')
							->from($this->table)
							->join('machines','option21.id_machines=machines.id_machines')
							->where('DATEDIFF(NOW(),date_fin) > 180')
							->get()
							->result();
		return $resultat;
	}	
}