<?php
defined('BASEPATH') OR exit('No direct script access allowed');
class Machines extends CI_Controller
{
	 public function __construct()
    {
        parent::__construct();
        $this->load->model('machines_model');
        $this->load->view('theme/header');
    }
    public function index()
    {
    	if ($this->session->userdata('identifiant')=='admin') {
            // si on a une session avec identifiant d'ouverte 
            // on appelle fonction affichage_list_machine qui fait ce que son nom indique x)
    		$this->affichage_liste_machines();
    		$this->creation_machines();
        }
		else
		{
			redirect('option21');
		}
    }
    public function creation_machines()
    { //création des options 21 
    	$this->load->view('machines/creation_machines');
    }
    public function insertion_bdd_machines()
    {
    	$nom=$this->input->post('nom_dns');
    	$type=$this->input->post('type');
    	$ville=$this->input->post('ville');
    	$this->machines_model->insertion_machines($nom,$type,$ville);
		redirect('machines');

    }
    public function affichage_liste_machines()
    {//gràace au model on recupère toues ls infos des machines sur bdd qu'on affecte dasn un tableau ici $data puis on envoie le tableu dans al vue
    	$data=array();
        $data['machines_detail'] = $this->machines_model->listing_machines(); 
    	
        $this->load->view('machines/liste_machines',$data);
    }
    public function modifier_machines($id)
    {//on récupère l'id de la machine via get puis on envoi vers formulaire de modif avec les infos de la amchine qu'on a affecté dans data
    	$data=array();
        $data['machines_detail'] = $this->machines_model->detail_machines($id);
        $this->load->view('machines/modif_machines',$data);     		
    }
    public function validation_modif_machines($id)
    {//recupère les infos du formulaire via post et l'id via get, puis on envoie vers model qui fait un update sur bdd
    	$nom=$this->input->post('nom_dns');
    	$type=$this->input->post('type');
    	$ville=$this->input->post('ville');
    	$id_machines=$id;// on recupère l'id par du GET via URL
    	$this->machines_model->maj_machines($id_machines,$nom,$type,$ville);
		redirect('machines');
    }
    public function supprimer_machines($id)
    {
    	//suppression de la machine
    	$id_machines=$id;
    	$this->machines_model->suppression_machines($id_machines);
    	redirect('machines');
    }
    public function infos_machines($id)
    {
        //suppression de la machine
        $id_machines=$id;
        $data=array();
        $data['machines_info']=$this->machines_model->infos_machines($id_machines);
        $this->load->view('machines/infos_machines',$data);
    }

}