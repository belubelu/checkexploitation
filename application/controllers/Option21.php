<?php
defined('BASEPATH') OR exit('No direct script access allowed');
class Option21 extends CI_Controller
{
	 public function __construct()
    {
        parent::__construct();
        $this->load->view('theme/header');
        $this->load->model('option21_model');
    }
    public function index()
    {
    	if (null!==($this->session->userdata('identifiant'))) {
            // si on a une session avec identifiant d'ouverte
            $data=array();
            $data['liste_option21']=$this->option21_model->listing_option21_planifier();
            $data['en_cours']=$this->option21_model->listing_option21_en_cours();
            $data['decompte']=$this->option21_model->decompte_en_cours();
            var_dump($data['decompte']);
    		$this->load->view('option21/apercu',$data);          
            $datahistorique=array();
            $datahistorique['historique']=$this->option21_model->listing_option21_historique();
            $this->load->view('option21/historique',$datahistorique);
        }
		else
		{
			redirect('login');
		}
    }
    public function planification()
    { //création des options 21 
        $this->load->model('machines_model');
        $data=array();
        // on envoi la liste de toutes les machines également pour selectioner la machine sur laquel on va créer l'option21
        $data['nom_machines']=$this->machines_model->afficher_liste_nom_machine();
    	$this->load->view('option21/planification',$data);
    }
    public function creation()
    {
    	$jeu=intval($this->input->post('jeu'));
        //comme j'ai choisi une balise select, il renvoit automatiquement en string , ce que je ne veux pas puisque j'inser dans bdd du int
        //du coup je vais intval($this...) pour convertir en int
    	$machines=$this->input->post('machines');
    	$date_planif=$this->input->post('date_planification');
        $identifiant=$this->session->userdata('identifiant');
        $this->form_validation->set_rules('date_planification', 'Date de planification', 'required',
                                                    array(  'required'=>'%s est requis .',));
        if ($this->form_validation->run()==true)
        {
            $this->option21_model->insertion_option21($jeu,$machines,$date_planif,$identifiant);
            redirect('option21');
        }
        else
        {
            $this->planification();
        }
    }
    public function supprimer_option21($id)
    {
        $id_option21=$id;
        $this->option21_model->suppression_option21($id_option21);
        redirect('option21');
    }
    public function start_option21($id)
    {
        $id_option21=$id;
        $this->option21_model->start_option21($id_option21);
        redirect('option21');
    }
    public function fin_ok_option21($id)
    {
        $id_option21=$id;
        $this->option21_model->fin_ok_option21($id_option21);
        redirect('option21');
    }
    public function fin_erreur_option21($id)
    {
        $id_option21=$id;
        $this->option21_model->fin_erreur_option21($id_option21);
        redirect('option21');
    }

}